<!--  This is an example server.xml running the OAuthCustomStoreBell example -->
<!--  Replace mongo-java-driver-2.14.2.jar with the correct name of your mongoDB jar -->

<?xml version="1.0" encoding="UTF-8"?>
<server description="new server">

    <!-- Enable features -->
    <featureManager>
        <feature>jsp-2.3</feature>
        <feature>oauth-2.0</feature>
        <feature>bells-1.0</feature>
    </featureManager>

    <!-- To access this server from a remote client add a host attribute to the following element, e.g. host="*" -->
    <httpEndpoint id="defaultHttpEndpoint"
                  httpPort="9080"
                  httpsPort="9443" />

    <!-- Automatically expand WAR files and EAR files -->
    <applicationManager autoExpand="true"/>
    
    <library id="customStoreLib">
        <!--  Replace mongo-java-driver-2.14.2.jar with the correct name of your mongoDB jar -->
        <fileset dir="${wlp.user.dir}/shared" includes="security.custom.store.bell_1.0.jar,mongo-java-driver-2.14.2.jar"/>
    </library>
    
    <bell libraryRef="customStoreLib" service="com.ibm.websphere.security.oauth20.store.OAuthStore" />
    
	<oauthProvider
		id="OAuthConfig"
		filter="request-url%=ssodemo"
		oauthOnly="false"
	>
	<!--  A short cleanupExpiredInterval allows the CustomStore Sample to be accessed automatically and quickly when the clean up fires -->
		<customStore storeId="mongoDbStore" cleanupExpiredInterval="30"/>
		<autoAuthorizeClient>dclient01</autoAuthorizeClient>
		<autoAuthorizeClient>dclient02</autoAuthorizeClient>
	</oauthProvider>
        
<oauth-roles>
  <authenticated>
    <user>testuser</user>
  </authenticated>
</oauth-roles>

<basicRegistry id="basic" realm="BasicRealm">
  <user name="testuser" password="testuserpwd" />
</basicRegistry>

<webAppSecurity allowFailOverToBasicAuth="true" />
</server>